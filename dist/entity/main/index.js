$(function(){"use strict";function t(t){window.wechat.share({title:t.title+("pending"==t.status?"(审核中)":""),description:t.content});var e=localStorage.getItem("VIEWED_ENTITYS");e=e?e.split(","):[],-1===e.indexOf(t.id)&&$.get("/services/entity/"+t.id+"/view",function(n){"success"==n.status&&(e.push(t.id),localStorage.setItem("VIEWED_ENTITYS",e.join(",")))});var n=$(".panel"),o=n.find(".ads");o.find(".ads-close").on("click",function(t){o.addClass("out")});var a=n.find(".tip");setTimeout(function(){o.addClass("out"),a.addClass("out")},3e3),$('<link rel="stylesheet"/>').attr("href","/page/"+t.Theme.code+"/css/style.css").appendTo("head"),$.get("/page/"+t.Theme.code+"/index.html",function(e){$('<script id="card-template" type="text/html"/>').html(e).appendTo($("body"));var s=0;t.Posts.forEach(function(t,e){t.id==i&&(s=e)}),n.append(template("entity-template",t));var c=new Swiper(".swiper-container",{spaceBetween:10,preloadImages:!1,lazyLoading:!0,lazyLoadingInPrevNext:!0,lazyLoadingOnTransitionStart:!0,initialSlide:parseInt(window.location.hash.slice(1))||s,onClick:function(e,n){location.href="/post/"+t.Posts[e.activeIndex].id},onSlideChangeStart:function(t){o.addClass("out"),a.addClass("out")}});n.find(".footer-bar .logo").on("click",function(){c.slideTo(0)})})}var e=location.pathname.split("/").slice(1)[1],n=location.href.match(/\?.*pid=([^&]*)/),i=n&&n[1];window.wechat.checkUser(!0,function(n){$.getJSON("/services/entity/"+e+n,function(e){"success"==e.status?t(e.data):console.error(e.data)})}),$(window).on("scroll",function(t){t.preventDefault()}).on("touchmove",function(t){t.preventDefault()}).on("mousemove","img",function(t){t.preventDefault()})});