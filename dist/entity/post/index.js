$(function(){"use strict";function t(t){var i="accept"==t.status,n=t.Cards[0]||{pictures:[],contents:[]};window.wechat.share({link:i?"":location.origin+"/entity/"+t.Entity.id,imgUrl:t.Entity.shareIcon,title:t.Entity.title,description:(i?n.contents[0]:"")||t.Entity.content});var o=localStorage.getItem("VIEWED_POSTS");o=o?o.split(","):[],-1===o.indexOf(t.id)&&$.get("/services/post/"+t.id+"/view",function(e){"success"==e.status&&(o.push(t.id),localStorage.setItem("VIEWED_POSTS",o.join(",")))}),$('<link rel="stylesheet"/>').attr("href","/page/"+t.Entity.Theme.code+"/css/style.css").appendTo("head"),$.get("/page/"+t.Entity.Theme.code+"/index.html",function(i){$('<script id="card-template" type="text/html"/>').html(i).appendTo($("body")),$(".panel").append(template("post-template",t));{var n=$(".post-card-index");new Swiper(".swiper-container",{preloadImages:!1,lazyLoading:!0,lazyLoadingInPrevNext:!0,lazyLoadingOnTransitionStart:!0,onSlideChangeStart:function(t){n.text(t.activeIndex+1+"/"+t.slides.length)}})}$(".footer-bar-back").on("click",function(){return location.href.match(/\?.*from=catalog/)?(history.back(),!1):void 0}),e(t)})}function e(t){var e=$(".post-like_count"),i=e.find("img"),n=e.find("span").text(t.likeCount),o=["/entity/post/img/icon-like.png","/entity/post/img/icon-like-active.png"],a=localStorage.getItem("LIKED_POSTS");a=a?a.split(","):[],a.indexOf(t.id)>-1?(e.addClass("active"),i.attr("src",o[1])):i.attr("src",o[0]),e.on("click",function(){var s=e.hasClass("active"),c="/services/post/"+t.id+"/"+(s?"unlike":"like");$.get(c,function(c){return"success"!=c.status?void console.error(c.data):(s?(t.likeCount--,a.splice(a.indexOf(t.id),1),i.attr("src",o[0])):(t.likeCount++,i.attr("src",o[1]),a.push(t.id)),e.toggleClass("active"),n.text(t.likeCount),void localStorage.setItem("LIKED_POSTS",a.join(",")))})})}var i=location.pathname.split("/").slice(1)[1];window.wechat.checkUser(!0,function(e){$.getJSON("/services/post/"+i+e,function(e){if("success"==e.status){if(!e.data.isCover&&"accept"!=e.data.Entity.status)return void console.error("ENTITY_IS_PENDING");t(e.data)}else console.error(e.data)})}),$(window).on("scroll",function(t){t.preventDefault()}).on("touchmove",function(t){t.preventDefault()}).on("mousemove","img",function(t){t.preventDefault()})});