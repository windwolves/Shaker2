$(function(){"use strict";function t(t){var n="accept"==t.status,i=t.Cards[0]||{pictures:[],contents:[]};window.wechat.share({link:n?"":location.origin+"/entity/"+t.Entity.id,imgUrl:(n?i.pictures[0]:"")||t.Entity.picture,title:t.Entity.title,description:(n?i.contents[0]:"")||t.Entity.content}),t.isCover&&(t.likeCount+=t.Entity.likeCount),$('<link rel="stylesheet"/>').attr("href","/page/"+t.Entity.Theme.code+"/css/style.css").appendTo("head"),$.get("/page/"+t.Entity.Theme.code+"/index.html",function(n){$('<script id="card-template" type="text/html"/>').html(n).appendTo($("body")),$(".panel").append(template("post-template",t));{var i=$(".post-card-index");new Swiper(".swiper-container",{preloadImages:!1,lazyLoading:!0,lazyLoadingInPrevNext:!0,lazyLoadingOnTransitionStart:!0,onSlideChangeStart:function(t){i.text(t.activeIndex+1+"/"+t.slides.length)}})}$(".footer-bar-back").on("click",function(){return location.href.match(/\?.*from=catalog/)?(history.back(),!1):void 0}),e(t)})}function e(t){var e=$(".post-like_count"),n=e.find("img"),i=e.find("span").text(t.likeCount),o=["/entity/post/img/icon-like.png","/entity/post/img/icon-like-active.png"],a=localStorage.getItem("LIKED_POSTS");a=a?a.split(","):[],a.indexOf(t.id)>-1?(e.addClass("active"),n.attr("src",o[1])):n.attr("src",o[0]),e.on("click",function(){var c=e.hasClass("active"),s="/services/post/"+t.id+"/"+(c?"unlike":"like");$.get(s,function(s){return"success"!=s.status?void console.error(s.data):(c?(t.likeCount--,a.splice(a.indexOf(t.id),1),n.attr("src",o[0])):(t.likeCount++,n.attr("src",o[1]),a.push(t.id)),e.toggleClass("active"),i.text(t.likeCount),void localStorage.setItem("LIKED_POSTS",a.join(",")))})})}var n=location.pathname.split("/").slice(1)[1];window.wechat.checkUser(!0,function(e){$.getJSON("/services/post/"+n+e,function(e){if("success"==e.status){if("accept"!=e.data.Entity.status)return void console.error("ENTITY_IS_PENDING");t(e.data)}else console.error(e.data)})}),$(window).on("scroll",function(t){t.preventDefault()}).on("touchmove",function(t){t.preventDefault()}).on("mousemove","img",function(t){t.preventDefault()})});