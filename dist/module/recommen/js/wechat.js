!function(e){function t(){location.href="https://open.weixin.qq.com/connect/oauth2/authorize?"+n({appid:"wxd6810c7d3b63d5c6",redirect_uri:encodeURIComponent(location.href),response_type:"code",scope:"snsapi_userinfo",state:"STATE#wechat_redirect"})}function n(e){if("object"!=typeof e)return e;var t="";for(var n in e)t+="&"+n+"="+e[n];return t.slice(1)}function o(e){var t=document.createElement("a");return t.href=e||location.href,{source:e,protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,params:function(){for(var e,n={},o=t.search.replace(/^\?/,"").split("&"),r=o.length,a=0;r>a;a++)o[a]&&(e=o[a].split("="),n[e[0]]=e[1]);return n}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[void 0,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[void 0,""])[1],segments:t.pathname.replace(/^\//,"").split("/")}}var r=navigator.userAgent,a=r&&r.match(/micromessenger/i),i={auth:"/services/wechat/auth/:code",authRefresh:"/services/wechat/auth/refresh/:refresh_token",signature:"/services/wechat/signature/:url",cleartoken:"/services/wechat/cleartoken"},c=function(){var n=window.wx,r=function(t){if(n)t();else if("function"==typeof define)require(["http://res.wx.qq.com/open/js/jweixin-1.0.0.js"],function(e){n=e,t()});else{if(!e)throw"Please load jquery first";var o=document.createElement("script");o.src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js",e(o).appendTo("head").on("load error",function(e){n=window.wx,t()})}},c=function(t,o){r(function(){e.get(i.signature.replace(":url",encodeURIComponent(t)),function(t){"success"==t.status?(n.config({debug:!!location.href.match(/\?.*debug=([^&]*)/),appId:t.data.appId,nonceStr:t.data.nonceStr,timestamp:t.data.timestamp,signature:t.data.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo"]}),n.ready(o),n.error(function(t){"invalid signature"==t&&e.get(i.cleartoken)})):console.error(t.data)})})},s=function(e){c(e.link,function(){n.onMenuShareTimeline({title:e.title,link:e.link,imgUrl:e.imgUrl,fail:function(e){console.log(e)}}),n.onMenuShareAppMessage({title:e.title,desc:e.description,link:e.link,imgUrl:e.imgUrl,success:function(e){console.log(e)},fail:function(e){console.log(e)}}),n.onMenuShareQQ({title:e.title,desc:e.description,link:e.link,imgUrl:e.imgUrl,fail:function(e){console.log(e)}}),n.onMenuShareWeibo({title:e.title,link:e.link,imgUrl:e.imgUrl,fail:function(e){console.log(e)}})})},l=function(n){var o=location.href.match(/\?.*code=([^&]*)/),r=o&&o[1];if(r)e.get(i.auth.replace(":code",r),function(e){if("success"==e.status){var t=e.data;localStorage.setItem("REFRESH_TOKEN",t.refresh_token),n(t)}});else{var a=localStorage.getItem("REFRESH_TOKEN");a?e.get(i.authRefresh.replace(":refresh_token",a),function(e){"success"==e.status?n(e.data):(localStorage.removeItem("REFRESH_TOKEN"),t())}):t()}};return{share:function(e){a&&(!e&&(e={}),!e.link&&(e.link=location.href.split("#")[0]),!e.imgUrl&&(e.imgUrl="/img/wechat_share_0"+Math.ceil(5*Math.random())+".png"),!e.content&&(e.content="稀客--带你离开现实表面的互动内容社区"),e.imgUrl=(location.origin+e.imgUrl).replace(/.*http/g,"http"),e.link=e.link.replace(/(_username=[^&]+)|(_password=[^&]+)/g,""),c(e.link,function(){s(e)}))},auth:function(e){if("function"!=typeof e)throw"callback must be function";var t=o().params;t._username&&t._password?e({username:t._username,password:t._password}):a&&r(function(){l(e)})},checkUser:function(t,n){if("function"==typeof t&&(n=t,t=!1),"function"!=typeof n)throw"callback must be function";var c=n;n=function(e){c(t?e?"?_username="+e.username+"&_password="+e.password:"":e||{})};var s=o().params;s._username&&s._password?n({username:s._username,password:s._password}):a?r(function(){var t=localStorage.getItem("REFRESH_TOKEN");t?e.get(i.authRefresh.replace(":refresh_token",t),function(e){"success"==e.status?n(e.data):n()}):n()}):n({})}}};window.wechat=c()}(window.$);